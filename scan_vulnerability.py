import urllib.request, urllib.error, urllib.parse
from bs4 import BeautifulSoup
import pprint
import requests

# 사이트 보안 취약점 스캔 Ex: admin.php SSL 인증서 등
# webvulnerscan // reference: https://github.com/Dk20/WebVulnerabilityScanner
def vulnerscan(url: str) -> list:
    result = []
    result.append("취약점 스캐닝.....")
    try:
        page=urllib.request.urlopen(url)
        parts = url.split("/")
        result.append(parts[-1])
        if (parts[-1]=="admin"):
            result.append("관리자 레이블 (Admin label) 취약점 발견")
        elif (parts[-1]=="login"):
            result.append("로그인 레이블 (Login label) 취약점 발견")
        else :
            soup = BeautifulSoup(page,"html.parser")
            for form in soup.findAll('form'):
                result.append("Form Method: "+form.get('method'))
                if(form.get('method')=='GET' or form.get('method')=='get'):
                    result.append("데이터 취약점 발견 (request sent via get method)")
            try:
                result=requests.get(url+"'")
                result.append("On preliminary sql injection status code : " + str(result.status_code))
                result.append("On preliminary sql injection response header from server : ")
                result.append(pprint.pformat(result.headers,width=1,indent=3))
                result.append('')
                a=[404,500,408,302]
                if(result.status_code in a):
                    result.append("본 사이트는 인젝션 공격 취약점이 발견되었습니다. ")
            except:
                result.append("본 사이트는 취약점이 발견되지 않았습니다. (Request denied)")
    except:
        result.append("SSL 인증서가 없습니다. 본 사이트는 공격에 취약합니다. (ssl certificate)")
        result.append("종료..........")
    return result
